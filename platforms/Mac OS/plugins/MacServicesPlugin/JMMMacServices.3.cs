'From Squeak3.8 of ''5 May 2005'' [latest update: #6665] on 13 June 2005 at 10:25:19 pm'!"Change Set:		JMMMacServicesDate:			13 June 2005Author:			johnmci@smalltalkconsulting.comMac Services, used by the Services logic to allow squeak to service requests from other application. The intial release executes the supplied UTF-8 string, then returns the result to the calling application"!Object subclass: #MacServicesInterface	instanceVariableNames: 'servicesSemaphore servicesSemaIndex'	classVariableNames: 'Current MacServicesProcess'	poolDictionaries: ''	category: 'Network-RemoteDirectory'!!MacServicesInterface methodsFor: 'accessing' stamp: 'JMM 6/12/2005 13:43'!getTextString	^self primGetTextString! !!MacServicesInterface methodsFor: 'accessing' stamp: 'JMM 6/12/2005 14:24'!setBasicType	self setDataTypes: 'TEXT'! !!MacServicesInterface methodsFor: 'accessing' stamp: 'JMM 6/12/2005 13:39'!setDataTypes: aDataTypeArray	self primSetDataTypes: aDataTypeArray! !!MacServicesInterface methodsFor: 'accessing' stamp: 'JMM 6/12/2005 15:14'!setReturnTextString: aString	self primSetReturnTextString: aString! !!MacServicesInterface methodsFor: 'accessing' stamp: 'JMM 6/12/2005 13:40'!setTextString: aString	self primSetTextString: aString! !!MacServicesInterface methodsFor: 'initialize-release' stamp: 'JMM 6/13/2005 21:31'!initialize	self installSemaphore.	self setBasicType.	self installServicesProcess! !!MacServicesInterface methodsFor: 'initialize-release' stamp: 'JMM 6/13/2005 21:44'!installSemaphore	servicesSemaphore := Semaphore new.	servicesSemaIndex := Smalltalk registerExternalObject: servicesSemaphore.	self primSetSemaphore: servicesSemaIndex.! !!MacServicesInterface methodsFor: 'initialize-release' stamp: 'JMM 6/13/2005 21:27'!installServicesProcess	MacServicesProcess ifNotNil: [MacServicesProcess terminate].	MacServicesProcess := [self macServicesProcessLogic] forkAt: Processor userBackgroundPriority.! !!MacServicesInterface methodsFor: 'system primitives' stamp: 'JMM 6/12/2005 13:42'!primGetTextString	<primitive:'primitiveGetTextString' module: 'ServicesPlugin'>! !!MacServicesInterface methodsFor: 'system primitives' stamp: 'JMM 6/12/2005 13:38'!primSetDataTypes: typeString	<primitive:'primitiveSetDataTypes' module: 'ServicesPlugin'>! !!MacServicesInterface methodsFor: 'system primitives' stamp: 'JMM 6/12/2005 15:14'!primSetReturnTextString: aString	<primitive:'primitiveSetReturnTextString' module: 'ServicesPlugin'>! !!MacServicesInterface methodsFor: 'system primitives' stamp: 'JMM 6/13/2005 21:39'!primSetSemaphore: aSemaIndex	<primitive:'primitiveSetSemaphore' module: 'ServicesPlugin'>! !!MacServicesInterface methodsFor: 'system primitives' stamp: 'JMM 6/12/2005 14:30'!primSetTextString: aString	<primitive:'primitiveSetTextString' module: 'ServicesPlugin'>! !!MacServicesInterface methodsFor: 'process' stamp: 'JMM 6/13/2005 21:50'!getDataExecuteAndReturn	| string results resultsString |	string := self getTextString.	results := Compiler evaluate: string.	resultsString := results printString.	self setReturnTextString: resultsString.! !!MacServicesInterface methodsFor: 'process' stamp: 'JMM 6/13/2005 22:19'!macServicesProcessLogic	[servicesSemaphore wait.	[self getDataExecuteAndReturn] on: Error do: [:ex | self setReturnTextString: String new].	true ] whileTrue.! !!MacServicesInterface class methodsFor: 'accessing' stamp: 'JMM 6/13/2005 21:21'!current	Current ifNil: [Current := self new].	^Current! !!MacServicesInterface class methodsFor: 'initialize-release' stamp: 'JMM 6/13/2005 21:21'!shutDown: quitting! !!MacServicesInterface class methodsFor: 'initialize-release' stamp: 'JMM 6/13/2005 21:34'!startUp: resuming	"The image is either being newly started (resuming is true), or it's just been snapshotted"	Current := nil.	self current.! !!MacServicesInterface class methodsFor: 'class initialization' stamp: 'JMM 6/13/2005 21:19'!initialize	"MacServicesInterface initialize"	Smalltalk addToStartUpList: self after: nil.	Smalltalk addToShutDownList: self after: nil.! !MacServicesInterface initialize!!MacServicesInterface class reorganize!('accessing' current)('initialize-release' shutDown: startUp:)('class initialization' initialize)!!MacServicesInterface reorganize!('accessing' getTextString setBasicType setDataTypes: setReturnTextString: setTextString:)('initialize-release' initialize installSemaphore installServicesProcess)('system primitives' primGetTextString primSetDataTypes: primSetReturnTextString: primSetSemaphore: primSetTextString:)('process' getDataExecuteAndReturn macServicesProcessLogic)!