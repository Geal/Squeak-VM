#!/bin/sh
# make make.inc for building Mpeg3Plugin in Squeak



echo "#### automatically generated by $0"




cat <<EOF
### Update make.inc if mkMakeInc changes
\$(Mpeg3Plugin_DIR)/make.inc : \$(Mpeg3Plugin_DIR)/mkMakeInc \$(Mpeg3Plugin_DIR)/libmpeg/make.inc
	cd \$(Mpeg3Plugin_DIR); sh ./mkMakeInc > make.inc

EOF




cat <<EOF

### Rules for building libmpeg3
EOF


cat <<EOF
LIBMPEG_CC:=\$(LIBTOOL) --mode=compile \$(CC)
LIBMPEG_CFLAGS:=-O3
LIBMPEG_LINKLIB:=\$(LIBTOOL) --mode=link \$(CC) -o
LIBMPEG_NASM:=nasm -f elf
LIBMPEG_SOURCE_DIR:=\$(Mpeg3Plugin_DIR)/libmpeg
LIBMPEG_BUILD_DIR:=\$(top_builddir)/libmpeg
LIBMPEG_OBJECT_EXT:=lo
LIBMPEG_LIBRARY_EXT:=la
EOF


cat libmpeg/make.inc



cat <<EOF
### Rules for Mpeg3Plugin


# rule for compiling Squeak-generated plugin file
Mpeg3Plugin.lo : \$(Mpeg3Plugin_DIR)/Mpeg3Plugin.c
	\$(LTCOMPILE)  -I\$(Mpeg3Plugin_DIR) -I\$(LIBMPEG_SOURCE_DIR) -I\$(LIBMPEG_SOURCE_DIR)/audio -I\$(LIBMPEG_SOURCE_DIR)/video \$(Mpeg3Plugin_DIR)/Mpeg3Plugin.c -c -o Mpeg3Plugin.lo

# rule for linking the plugin
Mpeg3Plugin.la : Mpeg3Plugin.lo \$(LIBMPEG_BUILD_DIR)/libmpeg3.la
	\$(LINK) Mpeg3Plugin -module -rpath \$(sqlibdir) -o Mpeg3Plugin.la Mpeg3Plugin.lo \$(LIBMPEG_BUILD_DIR)/libmpeg3.la
EOF


echo "#### end of rules generated by $0"
