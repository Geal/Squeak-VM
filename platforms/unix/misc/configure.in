# configure.in (v3.2) for Unix Squeak				-*- sh -*-
# 
# Process this file with autoconf to produce a configure script

#   Copyright (C) 1996 1997 1998 1999 2000 2001 Ian Piumarta and individual
#      authors/contributors listed elsewhere in this file.
#   All rights reserved.
#   
#   This file is part of Unix Squeak.
# 
#   This file is distributed in the hope that it will be useful, but WITHOUT
#   ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
#   FITNESS FOR A PARTICULAR PURPOSE.
#   
#   You may use and/or distribute this file ONLY as part of Squeak, under
#   the terms of the Squeak License as described in `LICENSE' in the base of
#   this distribution, subject to the following restrictions:
# 
#   1. The origin of this software must not be misrepresented; you must not
#      claim that you wrote the original software.  If you use this software
#      in a product, an acknowledgment to the original author(s) (and any
#      other contributors mentioned herein) in the product documentation
#      would be appreciated but is not required.
# 
#   2. This notice may not be removed or altered in any source distribution.
# 
#   Using or modifying this file for use in any context other than Squeak
#   changes these copyright conditions.  Read the file `COPYING' in the base
#   of the distribution before proceeding with any such use.
# 
#   You are STRONGLY DISCOURAGED from distributing a modified version of
#   this file under its original name without permission.  If you must
#   change it, rename it first.
# 
# Author: Ian.Piumarta@INRIA.Fr
# 
# Last edited: 2001-07-08 22:29:16 PDT by piumarta on emilia.inria.fr

# Hacked by Tim Rowledge (tim@sumeru.stanford.edu) to suport VMMaker system

AC_INIT(vm/sqXWindow.c)

MAJOR=3
MINOR=1a-4164

VERSION=$MAJOR.$MINOR

AC_SUBST(MAJOR)
AC_SUBST(MINOR)
AC_SUBST(VERSION)

AC_DEFINE_UNQUOTED(SQ_VERSION, "$VERSION")

AC_DEFINE(OS_TYPE, "unix")
AC_CANONICAL_HOST
host=$host_alias
host_cpu=`echo $host | sed 's,-.*,,'`
AC_SUBST(host)
AC_SUBST(host_cpu)
AC_SUBST(host_vendor)
AC_SUBST(host_os)
AC_DEFINE_UNQUOTED(VM_HOST, "$host")
AC_DEFINE_UNQUOTED(VM_HOST_OS, "$host_os")
AC_DEFINE_UNQUOTED(VM_HOST_CPU, "$host_cpu")

# Checks for programs.

AC_ARG_WITH(gnu-awk,
[  --with-gnu-awk          assume that awk is GNU gawk [default=no]],
GAWK="$withval", GAWK="unknown")

AC_ARG_WITH(gnu-as,
[  --with-gnu-as           assume that as is the GNU assembler [default=no]],
GAS="$withval", GAS="unknown")

AC_PROG_MAKE_SET
AC_PROG_CC_WALL
AC_PROG_CXX
AC_PROG_AS_GNU
AC_PROG_RANLIB
AC_PROG_INSTALL
AC_PROG_NM

AC_CHECK_PROG(LN, ln, ln)

AC_DISABLE_STATIC
AC_PROG_LIBTOOL

# Checks for X11

AC_PATH_XTRA

LIBS="$X_LIBS $LIBS"
CFLAGS="$X_CFLAGS $CFLAGS"

# Checks for header files.

AC_NEED_SUNOS_H

AC_STDC_HEADERS
AC_HAVE_HEADERS(unistd.h string.h fcntl.h sys/file.h sys/param.h)
AC_HAVE_HEADERS(sys/time.h sys/filio.h sys/select.h dlfcn.h)
AC_HEADER_TIME
AC_HEADER_DIRENT

AC_STRUCT_TIMEZONE

AC_CHECK_SOCKLEN_T
AC_CHECK_ATEXIT
AC_CHECK_TZSET
AC_CHECK_GMTOFF
AC_CHECK_TIMEZONE
AC_CHECK_GETHOSTNAME

# Checks for libraries.

AC_CHECK_LIB(nsl, yp_bind)
AC_CHECK_LIB(socket, socket)
AC_CHECK_FUNC(dlopen, AC_DEFINE(HAVE_LIBDL,1),
  AC_CHECK_LIB(dl, dlopen))
AC_CHECK_LIB(m,	sin)
AC_CHECK_LIB(X11, XOpenDisplay)
AC_CHECK_LIB(Xext, XShmAttach)

AC_ARG_ENABLE(jit,
[  --enable-jit            enable J3 support [default=no]],
JIT="yes", JIT="no")

test $JIT = "yes" && J_CFLAGS="-DJ_ENABLED"
AC_SUBST(J_CFLAGS)

# Checks for platform characteristics.

AC_GNU_OPT
AC_GNU_INTERP
AC_HAVE_OSS
AC_MODULE_LIB_PREFIX
AC_64BIT_ARCH

CFLAGS="$CFLAGS_32 $CFLAGS"

AC_C_BYTEORDER
AC_C_DOUBLE_ALIGNMENT
AC_C_DOUBLE_ORDER

# Configure files.

AC_CONFIG_HEADER(sqUnixConfig.h)
AC_MAKE_FRAGS(mh_frag, mt_frag, $topdir)
AC_OUTPUT(Makefile inisqueak)
