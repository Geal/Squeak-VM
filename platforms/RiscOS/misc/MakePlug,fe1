# Project:   sq31plugin
# Make the pluginised VM for v3.1

# Toolflags:
CCflags = -c -C -depend !Depend -IC:,OSLib:,C:^.socketincl,C:^.rink -throwback  -DACORN
C++flags = -c -depend !Depend -IC: -throwback
Linkflags = -aif -c++ -o $@  -S foo
ObjAsmflags = -throwback -NoCache -depend !Depend
CMHGflags = 
LibFileflags = -c -o $@
Squeezeflags = -o $@


# Final targets:
@.!Squeak.!Runimage:   @.vm.o.interp @.vm.o.sqArgument \
        @.vm.o.sqNamedPrims @.vm.o.sqRPCClipboard \
        @.vm.o.sqRPCEvents @.vm.o.sqRPCExternalPrims @.vm.o.sqRPCFormPrint \
        @.vm.o.sqRPCWindows @.vm.o.sqVirtualMachine @.vm.o.osExports \
        @.vm.o.fperrors OSLib:o.OSLib C:o.stubs @.vm.o.ptrblock C:^.rink.o.rink_rtsys 
        link $(linkflags)  @.vm.o.interp @.vm.o.sqArgument \
        @.vm.o.sqNamedPrims @.vm.o.sqRPCClipboard \
        @.vm.o.sqRPCEvents @.vm.o.sqRPCExternalPrims @.vm.o.sqRPCFormPrint \
        @.vm.o.sqRPCWindows @.vm.o.sqVirtualMachine @.vm.o.osExports \
        @.vm.o.fperrors OSLib:o.OSLib C:o.stubs @.vm.o.ptrblock C:^.rink.o.rink_rtsys 


# User-editable dependencies:
extractsymflags = o
socklib=OSLib:^.socketlibs.o.

vmobjdir:
        CDir @.!Squeak
        CDir @.vm.o

@.vm.o.ptrblock:   @.!Squeak.ptrblkmap 
        rinkptr $(rinkptrflags) @.!Squeak.ptrblkmap  @.vm.o.ptrblock

@.!Squeak.ptrblkmap:   vmobjdir C:o.stubs @.vm.o.sqRPCWindows @.vm.dsc.block
        copy @.vm.dsc.block $* f~c
        extractsym e $* C:o.stubs
        extractsym e $* @.vm.o.sqRPCWindows



# Static dependencies:
@.vm.o.interp:   vmobjdir @.vm.c.interp
        cc $(ccflags) -o @.vm.o.interp @.vm.c.interp 
@.vm.o.sqArgument:   vmobjdir @.vm.c.sqArgument
        cc $(ccflags) -o @.vm.o.sqArgument @.vm.c.sqArgument 
@.vm.o.sqNamedPrims:   vmobjdir @.vm.c.sqNamedPrims
        cc $(ccflags) -o @.vm.o.sqNamedPrims @.vm.c.sqNamedPrims 
@.vm.o.osExports:   vmobjdir @.vm.c.osExports
        cc $(ccflags) -o @.vm.o.osExports @.vm.c.osExports 
@.vm.o.sqRPCClipboard:   vmobjdir @.vm.c.sqRPCClipboard
        cc $(ccflags) -o @.vm.o.sqRPCClipboard @.vm.c.sqRPCClipboard 
@.vm.o.sqRPCEvents:   vmobjdir @.vm.c.sqRPCEvents
        cc $(ccflags) -o @.vm.o.sqRPCEvents @.vm.c.sqRPCEvents 
@.vm.o.sqRPCExternalPrims:   vmobjdir @.vm.c.sqRPCExternalPrims
        cc $(ccflags) -o @.vm.o.sqRPCExternalPrims @.vm.c.sqRPCExternalPrims 
@.vm.o.sqRPCFormPrint:   vmobjdir @.vm.c.sqRPCFormPrint
        cc $(ccflags) -o @.vm.o.sqRPCFormPrint @.vm.c.sqRPCFormPrint 
@.vm.o.sqRPCSyscall:   vmobjdir @.vm.c.sqRPCSyscall
        cc $(ccflags) -o @.vm.o.sqRPCSyscall @.vm.c.sqRPCSyscall 
@.vm.o.sqRPCWindows:   vmobjdir @.vm.c.sqRPCWindows
        cc $(ccflags) -o @.vm.o.sqRPCWindows @.vm.c.sqRPCWindows 
@.vm.o.sqVirtualMachine:   vmobjdir @.vm.c.sqVirtualMachine
        cc $(ccflags) -o @.vm.o.sqVirtualMachine @.vm.c.sqVirtualMachine
@.vm.o.fperrors:   vmobjdir @.vm.s.fperrors
        objasm $(objasmflags) -from @.vm.s.fperrors -to @.vm.o.fperrors


# Dynamic dependencies:
